# Backend API Specification for NeTuArk

> This file is auto-generated by AI from the React frontend only.  Frontend naming is preserved where necessary to map UI → backend.  All identifiers are placeholders – backend engineers may rename while keeping structure intact.

---

## Legend
| Emoji | Section |
|-------|---------|
| 🗺️ | Route overview |
| 🔐 | Access / roles |
| 🖥️ | Backend-relevant UI elements |
| 🗄️ | Data schema |
| 🔂 | User flow |
| ⚙️ | Backend requirements |
| 📥 | Request examples |
| 📤 | Response examples |
| 🗃️ | State & data handling |

All arrays are `[]` when empty, all dates ISO-8601.

---

## 1. Public Routes

### 1.1 `/`  *Landing*
🗺️  Show marketing hero + dynamic previews.

🔐  • Anonymous (✅) • Authenticated (✅; identical)

🖥️  Buttons: *Get started* → `/register`; *Explore* → `/explore`
Lists:
* Trending topic cards
* Popular community cards

🗄️  `TrendingTopic`, `Community` (see shared models)

🔂  ```javascript
GET /explore/trending            // 6 items
GET /communities?limit=6         // 6 items
```

⚙️  
| Method | Path | Purpose | Notes |
|--------|------|---------|-------|
| GET | /explore/trending | list topics | public |
| GET | /communities | list communities | supports `page,limit,search` |

🗃️  Stateless; backend must deliver lightweight payloads; pagination optional.

---

### 1.2 `/login`  *Login Page*

🗺️  Email/password & social-login.

🔐  • Anonymous (✅) • Authenticated redirect `/feed`

🖥️  Inputs: `email`, `password`, `rememberMe`; Social: Google / GitHub …

🗄️  
| Field | Type | Req | Validation |
|-------|------|-----|------------|
| email | string | ✅ | RFC 5322 |
| password | string | ✅ | 8-128 chars |
| rememberMe | boolean | ❌ | — |

🔂  ```javascript
POST /auth/login { email, password, rememberMe }
GET  /auth/oauth/{provider}
```

⚙️  See endpoint table at bottom.

🗃️  JWT issued; refresh token if `rememberMe`.

---

### 1.3 `/register`  *Registration*
🖥️  `realName`, `username`, `email`, `password`, `confirmPassword`, `acceptTerms` (checkbox)

🗄️  
| Field | Type | Req | Validation | Notes |
|-------|------|-----|------------|-------|
| realName | string | ✅ | 1-60 chars | |
| username | string | ✅ | `^[a-z0-9_]{3,20}$` | unique |
| email | string | ✅ | email | unique |
| password | string | ✅ | 8-128 chars, 1 upper,1 digit | |
| confirmPassword | string | ✅ | must match password | not stored |
| acceptTerms | boolean | ✅ | must be true | |

🔂  `POST /auth/register` → sends email verification.

⚙️  Returns `{ user, message }`; no token until OTP verified.

---

### 1.4 `/verify-otp`
🖥️  `email`, `otp`

🗄️  
| Field | Type | Req |
|-------|------|-----|
| email | string | ✅ |
| otp | string | ✅ | 6-digit |

🔂  `POST /auth/verify-otp` → returns accessToken + user.

---

### 1.5 `/forgot-password`
🖥️  `email`

🔂  `POST /auth/forgot-password` → sends reset link / code.

### 1.6 `/reset-password`
Query: `token=<resetToken>`
Inputs: `newPassword`, `confirmPassword`

🔂  `POST /auth/reset-password`  `{ token, newPassword }`

---

### 1.7 `/explore`
Lists: Trending Topics, Recommended Communities (auth only)

Endpoints:
* `GET /explore/trending`
* (auth) `GET /explore/recommended-communities`

---

## 2. Protected Routes  *(JWT required)*

### 2.1 `/feed`
Tabbed timeline: `all | following | communities` + create-post modal.

🖥️  • Infinite list of `Post` cards  • Button ➜ *Create Post* modal  • Comments drawer  • Tabs switch.

🗄️  `Post`, `Comment`, `Reaction`

🔂  
```
GET  /feed?page=1&type=all
POST /posts                     // create
POST /posts/:id/like            // reaction
GET  /posts/:id/comments?page=1
POST /posts/:id/comments        // add comment
```

### Create Post Modal

Purpose: Allows an authenticated user to publish a new post that can contain text, media, a poll, or an event configuration.

**Fields**

| Field | Type | Required | Purpose | Notes |
|------|------|----------|---------|-------|
| `content` | string | Yes* | Main body text for the post | Required unless `mediaFiles` or poll/event data is supplied |
| `mediaFiles[]` | file | Conditional | Image or video attachments | Multipart upload; multiple allowed |
| `postType` | enum | Yes | Validation & rendering strategy | `text`, `image`, `video`, `poll`, `event` |
| `privacy` | enum | Yes | Audience visibility | `public`, `friends`, `private` |
| `location` | string | No | Geographical tag | Free-text |
| `tags[]` | string | No | Hashtags to boost discoverability | Up to 10; each ≤ 30 chars |

*Required when no other content (media/poll/event) exists.

**Endpoint**

| Method | Path | Purpose | Auth | Notes |
|--------|------|---------|------|-------|
| POST | `/posts` | Create a new post using the above schema | Yes | Use `multipart/form-data` when files included |

---

### 2.2 `/search`

Purpose: Unified search endpoint returning paginated results across entity types.

**Query Parameters**

| Param | Type | Required | Purpose | Example |
|-------|------|----------|---------|---------|
| `q` | string | Yes | Search keyword | music |
| `type` | enum | No | Restrict results to an entity category | `users`, `posts`, `communities`, `hashtags`, `all` |
| `page` | int | No | Page number for pagination | 2 |

**Endpoint**

| Method | Path | Purpose | Auth | Notes |
|--------|------|---------|------|-------|
| GET | `/search` | Returns filtered, paginated search data | Yes | Rate-limited |

---

### 2.3 `/notifications`
Filter: `all | unread | mentions`; bulk actions.

Endpoints:
* `GET /notifications?page=1`
* `PUT /notifications/:id/read`
* `PUT /notifications/read-all`

---

### 2.4 `/messages`
Chat list + messages + group-create modal.

Endpoints:
* `GET /chats`
* `GET /chats/:chatId/messages?page=1`
* `POST /chats/:chatId/messages`  `{ content, type }`
* `POST /chats` (for new DM) / `POST /groups` (group)
* WebSocket `/ws/chat` for realtime (suggested)

---

### 2.5 `/communities`
Listing + search + pagination + join/leave.

Endpoints:
* `GET /communities?page=1&search=`
* `POST /communities`  (create)
* `POST /communities/{slug}/join`
* `POST /communities/{slug}/leave`

---

### 2.6 `/profile/:username`
Shows user, posts, follow/unfollow, stats.

Endpoints:
* `GET /users/{username}`
* `GET /users/{userId}/posts?page=1`
* `POST /users/{userId}/follow`
* `POST /users/{userId}/unfollow`

Followers & Following pages:
* `GET /users/{userId}/followers`
* `GET /users/{userId}/following`

---

### 2.7 `/settings`
Tabs: profile, password, notifications, business analytics.

#### Profile Tab
Fields: `name, bio, location, website, avatar(file)`
Endpoint: `PUT /users/profile`

#### Password Tab
Fields: `currentPassword, newPassword, confirmPassword`
Endpoint: `PUT /users/password`

#### Notifications Tab
Various boolean toggles (email, push, etc.)
Endpoint: `PUT /users/notifications`

#### Business Tab
Read-only analytics – `GET /analytics?range=7d`

---

### 2.8 `/drafts`
Local-only today; backend may store user drafts.
Suggested endpoint:
* `GET /drafts`
* `POST /drafts`
* `DELETE /drafts/:id`

### 2.9 `/schedule`
Schedule existing draft or new post.

Fields: `title, content, scheduledDate, scheduledTime, timezone, community, tags[]`
Endpoint:
* `POST /scheduled-posts`  (create/update)
* `GET  /scheduled-posts`
* `DELETE /scheduled-posts/:id`

---

## 3. Shared Models

### 3.1 User
```
_id: UUID
username: string (unique, 3-20)
realName: string
email: string (unique)
passwordHash: string
avatarUrl?: URL
bio?: string
location?: string
website?: URL
createdAt, updatedAt: datetime
```

### 3.2 Post
```
_id, authorId(FK→User), content, mediaUrls[], postType, privacy,
location?, tags[], createdAt, updatedAt, likeCount, commentCount
```

### 3.3 Comment
```
_id, postId(FK→Post), authorId, content, createdAt, parentId?
```

### 3.4 Community, TrendingTopic, Notification, Chat, Message, Draft, ScheduledPost … (see per-route specs)

---

## 4. Endpoint Master List

| Method | Endpoint | Purpose | Auth | Notes |
|--------|----------|---------|------|-------|
| GET | /explore/trending | trending topics | ❌ | limit param |
| GET | /communities | list communities | ❌ | page,search |
| POST | /communities | create | ✅ | body CommunityCreate |
| POST | /communities/{slug}/join | join | ✅ | |
| POST | /communities/{slug}/leave | leave | ✅ | |
| GET | /auth/profile | current user | ✅ | JWT |
| POST | /auth/register | sign up | ❌ | sends OTP |
| POST | /auth/verify-otp | verify email | ❌ | returns JWT |
| POST | /auth/login | sign in | ❌ | |
| GET | /auth/oauth/{provider} | social signin | ❌ | |
| POST | /auth/logout | logout | ✅ | revoke refresh |
| POST | /auth/forgot-password | send reset mail | ❌ | |
| POST | /auth/reset-password | reset pw | ❌ | token in body |
| GET | /feed | timeline | ✅ | page,type |
| POST | /posts | create post | ✅ | multipart |
| POST | /posts/{id}/like | like/unlike | ✅ | |
| GET | /posts/{id}/comments | list comments | ✅ | page |
| POST | /posts/{id}/comments | add comment | ✅ | |
| GET | /search | global search | ✅ | q,type,page |
| GET | /notifications | list | ✅ | page |
| PUT | /notifications/{id}/read | mark | ✅ | |
| PUT | /notifications/read-all | mark all | ✅ | |
| GET | /chats | list chats | ✅ | |
| GET | /chats/{id}/messages | list msgs | ✅ | page |
| POST | /chats/{id}/messages | send msg | ✅ | |
| GET | /users/{username} | profile | ✅ | public maybe |
| GET | /users/{id}/followers | followers | ✅ | |
| GET | /users/{id}/following | following | ✅ | |
| POST | /users/{id}/follow | follow | ✅ | |
| POST | /users/{id}/unfollow | unfollow | ✅ | |
| PUT | /users/profile | update profile | ✅ | |
| PUT | /users/password | change pw | ✅ | |
| PUT | /users/notifications | prefs | ✅ | |
| GET | /analytics | stats | ✅ | range param |
| GET | /drafts | user drafts | ✅ | optional |
| POST | /drafts | save draft | ✅ | |
| DELETE | /drafts/{id} | remove | ✅ | |
| GET | /scheduled-posts | list scheduled | ✅ | |
| POST | /scheduled-posts | create/update | ✅ | |
| DELETE | /scheduled-posts/{id} | delete | ✅ | |

---

## 5. Error & Validation Rules
Standard JSON error wrapper
```jsonc
{ "error": "Message", "code": 400, "details": { ... } }
```
• 400 – validation, 401 – auth, 403 – permission, 404 – not found, 429 – rate-limit, 500 – server.

---

### END OF SPEC
